= content_for :title, "Plan and permissions"


%div(class="container")
  
  %div(class="header")
    %div(class="content")
      %div(class="header-container")
        %div(class="header-title")
          %h1(class="text text-xxl text-medium") Plan and permissions
        -# %div(class="header-actions")
        -#   %div(class="header-actions-item")
        -#     = link_to :back, class: "button-circle" do
        -#       %div(class="button-circle-icon") #{icon "fal", "long-arrow-left"}
        -#       %div(class="button-circle-name") Back


  %section(class="section")
    %div(class="content")
      %div(class="section-annotated")
        %div(class="section-annotated-annotation")
          %p(class="text text-m text-medium space-bot-xs") Plan details:
          %p(class="text text-s text-secondary") View our #{link_to "terms of service", "", class: "link"} and #{link_to "privacy policy", "", class: "link"}.
          - if !@seller_subscription
            %p(class="text text-s text-secondary space-top-m") #{link_to "Compare plans", seller_pricing_path, class: "link"} with different features and rates.
        %div(class="section-annotated-content")
          %div(class="body")
            %div(class="card")
              %div(class="grid-1-3")
                %div(class="col")
                  %div(class="card-body")
                    %p(class="text text-s text-secondary space-bot-xxxs") Member since:
                    %p(class="text text-s text-medium") #{@seller.member_since}
                %div(class="col")
                  %div(class="card-body")
                    - @ss = @seller.subscription
                    %p(class="text text-s text-secondary space-bot-xxxs") Current plan:
                    - if @ss.present?
                      %p(class="text text-s text-medium") #{@ss.stripe_plan}
                    - else
                      %p(class="text text-s text-medium") ---
                %div(class="col")
                  %div(class="card-body")
                    %p(class="text text-s text-secondary space-bot-xxxs") Status:
                    - if @seller_subscription
                      %p(class="text text-s text-medium") #{@seller_subscription.status.humanize}
                    - else
                      %p(class="text text-s text-medium") Incomplete
          
          %div(class="body")

            - if @seller_subscription && @seller_subscription.on_trial?
              %div(class="card")
                %div(class="card-header")
                  %div(class="card-header-main") 
                    %h1(class="text text-m text-medium") #{@seller_subscription.stripe_plan} trial period
                %div(class="card-body")
                  %p(class="text text-s") #{current_user.first_name}, you have #{pluralize((@seller_subscription.trial_ends_at.to_date - Time.now.to_date).to_i, 'day')} left of your trial. The first payment will be on #{@seller_subscription.trial_ends_at.to_date.to_s(:long)}.
                %div(class="card-footer")
                  %div(class="card-footer-actions")
                    %div(class="card-footer-action") #{link_to "Change plan", edit_seller_subscription_path, class: "button"}
            
            - elsif @seller_subscription && @seller_subscription.on_grace_period?
              %div(class="card")
                %div(class="card-header")
                  %div(class="card-header-main") 
                    %h1(class="text text-m text-medium") Subscription canceled
                %div(class="card-body")
                  %p(class="text text-s") Your subscription has been canceled. The access will remain until #{@seller_subscription.ends_at.to_date.to_s(:long)}.
                %div(class="card-footer")
                  %div(class="card-footer-actions")
                    %div(class="card-footer-action") #{link_to "Resume subscription", resume_seller_subscription_path, method: :patch, class: "button"}

            - elsif @seller_subscription && @seller_subscription.active?
              %div(class="card")
                %div(class="card-header")
                  %div(class="card-header-main") 
                    %h1(class="text text-m text-medium") Active subscription
                %div(class="card-body")
                  %p(class="text text-s") You are subscribed to the #{@seller_subscription.stripe_plan} plan.
                %div(class="card-footer")
                  %div(class="card-footer-actions")
                    %div(class="card-footer-action") #{link_to "Change plan", edit_seller_subscription_path, class: "button"}
                    %div(class="card-footer-action") #{link_to "Cancel", seller_subscription_path, method: :delete, class: "link link-secondary", data: { confirm: "Are you sure you want to cancel?" }}
        
            -#   - else
            -#     %p.text.text-s You are not subscribed. #{link_to "Subscribe", seller_pricing_path, class: "link"}
  

  %section(class="section")
    %div(class="content")
      %div(class="section-annotated")
        %div(class="section-annotated-annotation")
          %p(class="text text-m text-medium space-bot-xs") Connected accounts:
          %p(class="text text-s text-secondary") Manage what staff can see or do in your store.
        %div(class="section-annotated-content")
          %div(class="body")
            %ul(class="list")
              - @seller_accounts.each do |acc|
                %li(class="list-item")
                  -# %div(class="list-container list-container-center")
                  = link_to account_path(acc), class: "list-container list-container-center" do
                    %div(class="list-picture list-picture-rounded")
                      = image_tag acc.user.avatar(300, 300), loading: "lazy"
                    %div(class="list-main")
                      %h1(class="text text-s text-medium") #{acc.user.full_name}
                      %p(class="text text-s text-secondary") Owner
          -# %div(class="body")
          -#   = link_to "Invite Contributor", "", class: "button button-wide"


  %section(class="section")
    %div(class="content")
      %div(class="section-annotated")
        %div(class="section-annotated-annotation")
          %p(class="text text-m text-medium") Seller account status:
        %div(class="section-annotated-content")
          %div(class="body")
            %div(class="card")
              %div(class="grid-1-2")
                %div(class="col")
                  %div(class="card-body")
                    %div(class="text-center")
                      %h1(class="text text-xxxl space-bot-l") #{icon "fal", "pause"}
                      %p(class="text text-s space-bot-xxxs") Pause your account
                      %p(class="text text-s text-secondary space-bot-l") Take a break from selling at a reduced plan price. Your settings will be saved until youâ€™re ready to sell again.
                      = link_to "Pause account", "", class: "button"
                %div(class="col")
                  %div(class="card-body")
                    %div(class="text-center")
                      %h1(class="text text-xxxl space-bot-l") #{icon "fal", "times-circle"}
                      %p(class="text text-s space-bot-xxxs") Close your account
                      %p(class="text text-s text-secondary space-bot-l") Turn off your online sales. All related to #{@seller.name} information will be forever removed from Dagglo.
                      = link_to "Close account", seller_path, method: :delete, class: "button"